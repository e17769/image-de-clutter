# Story 1.3: Image File Discovery and Listing

## Status
Draft

## Story
**As a** user,
**I want** the application to find all image files in my selected folder and subfolders,
**so that** I can see what images will be analyzed for duplicates.

## Acceptance Criteria
1. Application recursively scans selected directory for image files (.jpg, .jpeg, .png, .gif)
2. File discovery respects common image file extensions (case insensitive)
3. Hidden files and system directories are appropriately handled/skipped
4. Total count of discovered images is displayed to user
5. Basic error handling for permission issues or corrupted directory structures
6. Scan operation can be cancelled by user if needed
7. Progress indication is shown during file discovery process

## Tasks / Subtasks
- [ ] Task 1: Implement recursive file discovery (AC: 1, 2)
  - [ ] Create file scanner class for recursive directory traversal
  - [ ] Support enhanced file format list from PRD (jpg, jpeg, png, gif, tiff, webp, heic, bmp, cr2, nef, arw, dng)
  - [ ] Implement case-insensitive extension matching
  - [ ] Filter files by supported image extensions
- [ ] Task 2: Handle system files and permissions (AC: 3, 5)
  - [ ] Skip hidden files and directories (.DS_Store, etc.)
  - [ ] Skip system directories (/System, /Library, etc.)
  - [ ] Handle permission denied errors gracefully
  - [ ] Log access issues for debugging
- [ ] Task 3: Add progress tracking and cancellation (AC: 6, 7)
  - [ ] Implement threaded file discovery for UI responsiveness
  - [ ] Add progress signals for UI updates
  - [ ] Implement cancellation mechanism
  - [ ] Update progress bar during scanning
- [ ] Task 4: Display scan results to user (AC: 4)
  - [ ] Show total count of discovered images
  - [ ] Display scan progress and status
  - [ ] Show file types found breakdown
  - [ ] Provide basic statistics (total size, etc.)
- [ ] Task 5: Add comprehensive testing
  - [ ] Unit tests for file discovery logic
  - [ ] Test with various directory structures
  - [ ] Test permission error handling
  - [ ] Test cancellation functionality

## Dev Notes

### File Format Support (Enhanced from PRD v1.1)
The PRD was updated to include expanded file format support:
- **Common formats**: .jpg, .jpeg, .png, .gif, .tiff, .webp, .heic, .bmp
- **Professional RAW formats**: .cr2, .nef, .arw, .dng

This addresses competitive analysis showing PhotoSweeper Pro and professionals need RAW support.

### User Personas Impact
- **Sarah (Family)**: Primarily .jpg, .png from phones and cameras
- **Marcus (Professional)**: Needs RAW format support (.cr2, .nef, .arw)
- **David (Tech)**: Mixed formats including .webp, .heic from various sources
- **Linda (Librarian)**: Historical formats, .tiff from scanning

### Performance Requirements
- Handle up to 50,000 images efficiently (NFR8 from PRD)
- Target 500+ images/minute for discovery phase
- Maintain UI responsiveness during scanning
- Memory efficient for large directory structures

### macOS Specific Considerations
- Handle .DS_Store and other macOS metadata files
- Respect macOS file permissions and sandboxing
- Support for network mounted drives
- Handle case-insensitive but case-preserving filesystem

### Threading Architecture
- Use QThread for background file discovery
- Emit progress signals for UI updates
- Implement proper cancellation with thread cleanup
- Avoid blocking the main UI thread

### Error Handling Strategy
- Graceful handling of permission denied errors
- Skip corrupted or inaccessible directories
- Log errors for debugging but don't crash
- User-friendly error messages

### Testing Strategy
- Mock file system for consistent testing
- Test with various directory structures
- Test permission scenarios
- Performance testing with large file sets
- Cancellation and threading tests

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-12-20 | 1.0 | Initial story creation | Scrum Master |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by Dev Agent*

### Debug Log References
*To be filled by Dev Agent*

### Completion Notes List
*To be filled by Dev Agent*

### File List
*To be filled by Dev Agent*

## QA Results
*This section will be populated by the QA Agent during review*
