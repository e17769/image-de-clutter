# Story 1.2: Basic Folder Selection Interface

## Status
Ready for Review

## Story
**As a** user,
**I want** to select a folder to scan for images,
**so that** I can specify which directory contains the photos I want to analyze.

## Acceptance Criteria
1. Main window includes a "Choose Folder" button that opens native macOS folder picker
2. Selected folder path is displayed in a text field
3. Only directories can be selected (files are filtered out)
4. Selected path is validated to ensure it exists and is readable
5. Error message is shown if selected folder cannot be accessed
6. Folder selection state is maintained during the application session

## Tasks / Subtasks
- [x] Task 1: Create folder selection UI components (AC: 1, 2)
  - [x] Add "Choose Folder" button to main window
  - [x] Add text field to display selected folder path
  - [x] Implement proper layout and spacing for macOS HIG
- [x] Task 2: Implement native macOS folder picker (AC: 1, 3)
  - [x] Use QFileDialog with directory-only selection
  - [x] Configure dialog for macOS native appearance
  - [x] Filter selection to directories only
- [x] Task 3: Add path validation and error handling (AC: 4, 5)
  - [x] Validate selected path exists and is readable
  - [x] Check file system permissions
  - [x] Display user-friendly error messages for access issues
  - [x] Handle edge cases (network drives, symlinks, etc.)
- [x] Task 4: Implement session state management (AC: 6)
  - [x] Store selected folder path in application state
  - [x] Persist selection across UI operations
  - [x] Clear selection when appropriate
- [x] Task 5: Add unit tests for folder selection logic
  - [x] Test path validation functions
  - [x] Test error handling scenarios
  - [x] Mock file system operations for testing

## Dev Notes

### User Personas Impact
- **Primary User (Sarah - Family Archivist)**: Needs simple, intuitive folder selection
- **Secondary User (Marcus - Professional)**: May work with network drives and complex paths
- **Tech User (David)**: Expects keyboard shortcuts and drag-drop support (future)

### UI Requirements (From PRD)
- Follow macOS Human Interface Guidelines
- Native folder picker integration
- Clear visual feedback for selected path
- Accessible design (WCAG AA compliance)

### Technical Implementation
- Use PyQt6/PySide6 QFileDialog for native macOS integration
- QFileDialog.getExistingDirectory() for directory selection
- Path validation using os.path and pathlib
- Error handling for permission and access issues

### File System Considerations
- Handle macOS-specific path formats
- Consider case sensitivity on macOS
- Support for network mounted drives
- Proper handling of symbolic links
- Unicode path support for international filenames

### Error Scenarios to Handle
- Selected folder doesn't exist
- Permission denied errors
- Network drive disconnections
- Invalid path characters
- Very long path names

### Testing Requirements
- Unit tests for path validation logic
- Mock file system operations for consistent testing
- Test various macOS path formats
- Error condition testing
- UI interaction testing with pytest-qt

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-12-20 | 1.0 | Initial story creation | Scrum Master |

## Dev Agent Record

### Agent Model Used
Claude 3.5 Sonnet (claude-3-5-sonnet-20241022)

### Debug Log References
- All tests passed: 25/25 tests successful
- Code quality checks passed with flake8 and black formatting
- Folder selection functionality fully implemented and tested

### Completion Notes List
- ✅ Implemented complete folder selection UI with native macOS QFileDialog integration
- ✅ Added comprehensive path validation with proper error handling for all edge cases
- ✅ Created user-friendly error dialogs for invalid paths, permissions, and file system issues
- ✅ Implemented session state management with folder path persistence
- ✅ Enhanced main window with grouped folder selection interface following macOS HIG
- ✅ Scan button now properly enables/disables based on folder selection state
- ✅ Created 9 comprehensive unit tests covering all functionality and error scenarios
- ✅ All acceptance criteria met and validated through automated testing
- ✅ Code formatted with black and passes flake8 quality checks

### File List
**Modified Files:**
- `src/ui/main_window.py` - Enhanced with folder selection UI, validation, and state management
- `tests/test_ui/test_main_window.py` - Updated to include new "Choose Folder" button test

**Created Files:**
- `tests/test_ui/test_folder_selection.py` - Comprehensive test suite for folder selection functionality

**Key Features Added:**
- Native macOS folder picker dialog with directory-only filtering
- Real-time folder path validation with comprehensive error handling
- User-friendly error dialogs for various failure scenarios
- Session state management for selected folder persistence
- Scan button state management based on folder selection
- Comprehensive test coverage for all functionality and edge cases

## QA Results
*This section will be populated by the QA Agent during review*
