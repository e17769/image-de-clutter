# Story 1.4: Basic Duplicate Detection Implementation

## Status
Draft

## Story
**As a** user,
**I want** to see a simple list of duplicate images found in my folder,
**so that** I can verify the core duplicate detection functionality is working.

## Acceptance Criteria
1. imagededup library is integrated and functional
2. Basic hash-based duplicate detection (PHash or DHash) is implemented
3. Detected duplicates are grouped and displayed in a simple list format
4. Each duplicate group shows file paths of matching images
5. Basic error handling for corrupted or unreadable image files
6. Detection process shows progress indication
7. Results clearly indicate how many duplicate groups were found
8. Simple "Scan for Duplicates" button triggers the detection process

## Tasks / Subtasks
- [ ] Task 1: Integrate imagededup library (AC: 1, 2)
  - [ ] Add imagededup to requirements.txt
  - [ ] Create duplicate detection service class
  - [ ] Implement PHash-based duplicate detection
  - [ ] Test basic duplicate detection functionality
- [ ] Task 2: Implement duplicate grouping logic (AC: 3, 4)
  - [ ] Process imagededup results into grouped format
  - [ ] Create data structures for duplicate groups
  - [ ] Handle edge cases (single images, multiple duplicates)
  - [ ] Sort groups by similarity score or size
- [ ] Task 3: Create basic results display UI (AC: 3, 4, 7)
  - [ ] Add results area to main window
  - [ ] Display duplicate groups in list format
  - [ ] Show file paths for each image in group
  - [ ] Display total number of groups found
- [ ] Task 4: Add scan trigger and progress (AC: 6, 8)
  - [ ] Add "Scan for Duplicates" button
  - [ ] Implement threaded scanning for UI responsiveness
  - [ ] Show progress during detection process
  - [ ] Handle scan completion and results display
- [ ] Task 5: Implement error handling (AC: 5)
  - [ ] Handle corrupted or unreadable image files
  - [ ] Skip problematic files with logging
  - [ ] Display error summary to user
  - [ ] Ensure robust operation with mixed file types
- [ ] Task 6: Add comprehensive testing
  - [ ] Unit tests for duplicate detection logic
  - [ ] Test with known duplicate sets
  - [ ] Test error handling scenarios
  - [ ] Integration tests for full scan workflow

## Dev Notes

### imagededup Library Integration
The imagededup library provides multiple algorithms for duplicate detection:
- **PHash (Perceptual Hash)**: Good balance of speed and accuracy
- **DHash (Difference Hash)**: Fast, good for exact and near-exact duplicates
- **CNN-based**: More accurate but slower (will be implemented in Story 2.1)

For this story, focus on PHash as it provides good results for most users.

### Competitive Analysis Context
Based on market research:
- **PhotoSweeper Pro** uses multiple hash algorithms combined
- **Duplicate Photos Fixer Pro** emphasizes accuracy over speed
- **Our differentiation**: Open source transparency with explainable results

### User Personas Requirements
- **Sarah (Family)**: Needs simple, reliable detection of obvious duplicates
- **Marcus (Professional)**: Expects accurate detection without false positives
- **David (Tech)**: Wants to understand algorithm choices and parameters
- **Linda (Librarian)**: Requires conservative detection with audit trail

### Performance Expectations
- Process 1,000-5,000 images efficiently for Epic 1
- Target: 500+ images/minute for hash-based detection (NFR8)
- Memory usage under 1GB for basic collections
- Maintain UI responsiveness during processing

### Technical Implementation Details
```python
# Basic imagededup usage pattern
from imagededup import methods

# Initialize hash method
hasher = methods.PHash()

# Generate hashes for images
hashes = hasher.encode_images(image_dir='path/to/images')

# Find duplicates
duplicates = hasher.find_duplicates(hashes)
```

### Error Handling Strategy
- Skip corrupted images rather than failing entire scan
- Log problematic files for user review
- Provide summary of skipped files
- Handle various image format issues gracefully

### Data Structures for Results
```python
# Duplicate group structure
{
    'group_id': unique_identifier,
    'similarity_algorithm': 'phash',
    'images': [
        {
            'path': '/full/path/to/image.jpg',
            'hash': 'computed_hash_value',
            'file_size': size_in_bytes,
            'dimensions': (width, height)
        }
    ]
}
```

### UI Design Considerations
- Simple list-based display for Epic 1
- Clear grouping visual indicators
- File path truncation for readability
- Basic statistics display
- Foundation for thumbnail display in Epic 3

### Testing Strategy
- Create test image sets with known duplicates
- Test with various image formats and sizes
- Performance testing with larger sets
- Error condition testing with corrupted files
- Mock imagededup for unit testing

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-12-20 | 1.0 | Initial story creation | Scrum Master |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by Dev Agent*

### Debug Log References
*To be filled by Dev Agent*

### Completion Notes List
*To be filled by Dev Agent*

### File List
*To be filled by Dev Agent*

## QA Results
*This section will be populated by the QA Agent during review*
